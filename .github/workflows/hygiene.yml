name: Hygiene

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  no-committed-artifacts:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Fail if release/local artifacts are committed
        shell: bash
        run: |
          set -euo pipefail

          dmg_tracked="$(git ls-files '*.dmg' || true)"
          db_tracked="$(git ls-files 'sqlite:narrative.db' || true)"

          if [[ -n "${dmg_tracked}" ]]; then
            echo "ERROR: DMG files must not be committed. Publish via GitHub Releases instead."
            echo "${dmg_tracked}"
            exit 1
          fi

          if [[ -n "${db_tracked}" ]]; then
            echo "ERROR: sqlite:narrative.db must not be committed (local cache placeholder)."
            echo "${db_tracked}"
            exit 1
          fi

          echo "OK: No tracked DMGs or sqlite:narrative.db."

